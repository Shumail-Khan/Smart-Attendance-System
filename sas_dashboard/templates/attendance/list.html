{% extends "base.html" %}
{% block content %}

<div class="p-6 space-y-6">

    <!-- SUMMARY -->
    <div class="grid grid-cols-2 gap-4">
        <div class="bg-green-100 p-4 rounded-xl">
            <p class="text-sm">Present (IN)</p>
            <p class="text-2xl font-bold">{{ summary.in }}</p>
        </div>
        <div class="bg-red-100 p-4 rounded-xl">
            <p class="text-sm">Exit (OUT)</p>
            <p class="text-2xl font-bold">{{ summary.out }}</p>
        </div>
    </div>

    <!-- FILTERS -->
    <form method="get" class="grid grid-cols-6 gap-2 bg-white p-4 rounded-xl shadow">
        <input type="date" name="date_from" class="border p-2 rounded">
        <input type="date" name="date_to" class="border p-2 rounded">

        <select name="person" class="border p-2 rounded">
            <option value="">All Persons</option>
            {% for p in persons %}
            <option value="{{ p.pid }}">{{ p.person_name }}</option>
            {% endfor %}
        </select>

        <select name="camera" class="border p-2 rounded">
            <option value="">All Cameras</option>
            {% for c in cameras %}
            <option value="{{ c.camera_id }}">{{ c.location }}</option>
            {% endfor %}
        </select>

        <select name="type" class="border p-2 rounded">
            <option value="">IN/OUT</option>
            <option value="IN">IN</option>
            <option value="OUT">OUT</option>
        </select>

        <input type="text" name="search" placeholder="Search name" class="border p-2 rounded col-span-2">

        <button class="bg-blue-600 text-white rounded px-4">Filter</button>
        <a href="{% url 'attendance_export' %}" class="bg-gray-800 text-white rounded px-4 text-center">
            Export CSV
        </a>
    </form>

    <!-- TABLE -->
    <div class="bg-white rounded-xl shadow overflow-x-auto">
        <table class="w-full text-sm">
            <thead class="bg-gray-100">
                <tr>
                    <th class="p-2">Time</th>
                    <th>Photo</th>
                    <th>Person</th>
                    <th>Camera</th>
                    <th>Type</th>
                    <th>Confidence</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% for r in records %}
                <tr class="border-t hover:bg-gray-50">
                    <td class="p-2 text-center">{{ r.timestamp }}</td>
                    <td class="">
                        {% if r.image_path %}
                        <img src="{{ r.image_path }}" class="h-10 rounded">
                        {% endif %}
                    </td>
                    <td class="text-center">{{ r.person_name }}</td>
                    <td class="text-center">{{ r.camera.location }}</td>
                    <td class="text-center">
                        <span class="px-2 py-1 rounded text-xs
              {% if r.attendance_type == 'IN' %}
              bg-green-100 text-green-700
              {% else %}
              bg-red-100 text-red-700
              {% endif %}">
                            {{ r.attendance_type }}
                        </span>
                    </td>
                    <td class="text-center">{{ r.confidence|default:"â€”" }}</td>
                    <td class="text-center">
                        <button onclick="openModal('{{ r.id }}')" class="text-blue-600">
                            View
                        </button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <div id="modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center">
        <div class="bg-white rounded-xl p-6 w-1/3">
            <h2 class="text-lg font-bold mb-4">Attendance Detail</h2>
            <p>This will show full image, person info, correction button.</p>
            <button onclick="closeModal()" class="mt-4 bg-gray-800 text-white px-4 py-2 rounded">
                Close
            </button>
        </div>
    </div>

    <script>
        function openModal() {
            document.getElementById("modal").classList.remove("hidden")
        }
        function closeModal() {
            document.getElementById("modal").classList.add("hidden")
        }
    </script>


</div>

{% endblock %}